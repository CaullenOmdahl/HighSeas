var A=Object.defineProperty;var I=(n,t,e)=>t in n?A(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var o=(n,t,e)=>I(n,typeof t!="symbol"?t+"":t,e);import{B as x}from"./DXSXZ86w.js";const w=x,b={baseUrl:"torrentio.strem.fun",excludeQuality:["brremux","threed","480p","other","scr","cam","unknown"],debridOptions:["nodownloadlinks","nocatalog"],providers:["yts","eztv","rarbg","horriblesubs","nyaasi"]};function C(){const n=`qualityfilter=${b.excludeQuality.join(",")}`,t=`debridoptions=${b.debridOptions.join(",")}`,e=`providers=${b.providers.join(",")}`,r=[n,e,t,"realdebrid={REAL_DEBRID_TOKEN}"].join("|");return`stremio://${b.baseUrl}/${r}/manifest.json`}const y={preInstalledAddons:["https://v3-cinemeta.strem.io/manifest.json","https://watchhub.strem.io/manifest.json",C(),"https://torrentio.strem.fun/manifest.json"],defaultAddons:[],qualityFilter:{excluded:b.excludeQuality,allowed:["1080p","2160p","4k","uhd","hdr","dolby","atmos"]}};function S(n){return!n||n.length===0?n:n.filter(t=>{const e=(t.title||t.name||"").toLowerCase(),s=(t.description||"").toLowerCase(),r=`${e} ${s}`;return y.qualityFilter.excluded.some(c=>r.includes(c.toLowerCase()))?!1:(y.qualityFilter.allowed.some(c=>r.includes(c.toLowerCase()))||!R(r),!0)})}function R(n){return[...y.qualityFilter.excluded,...y.qualityFilter.allowed,"720p","hd","bluray","webrip","webdl","dvdrip"].some(e=>n.includes(e.toLowerCase()))}var T=(n=>(n.NETWORK="NETWORK",n.STREAM="STREAM",n.PLAYER="PLAYER",n.ADDON="ADDON",n.PERMISSION="PERMISSION",n.VALIDATION="VALIDATION",n.UNKNOWN="UNKNOWN",n))(T||{}),$=(n=>(n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH",n.CRITICAL="CRITICAL",n))($||{});class f extends Error{constructor(e){super(e.message);o(this,"category");o(this,"severity");o(this,"originalError");o(this,"context");o(this,"recoverable");o(this,"userMessage");o(this,"actionable");o(this,"retryable");o(this,"errorId");this.name="StreamingError",this.category=e.category,this.severity=e.severity,this.originalError=e.originalError,this.recoverable=e.recoverable,this.actionable=e.actionable??!0,this.retryable=e.retryable??!1,this.context={timestamp:Date.now(),userAgent:typeof navigator<"u"?navigator.userAgent:void 0,url:typeof window<"u"?window.location.href:void 0,...e.context},this.userMessage=e.userMessage||this.getDefaultUserMessage(),this.errorId=this.generateErrorId(),Error.captureStackTrace&&Error.captureStackTrace(this,f)}getDefaultUserMessage(){switch(this.category){case"NETWORK":return"Network connection issues detected. Please check your internet connection and try again.";case"STREAM":return"Unable to load the video stream. The content may be temporarily unavailable.";case"PLAYER":return"Video player encountered an error. Try refreshing the page or using a different browser.";case"ADDON":return"Content source is currently unavailable. Please try again later.";case"PERMISSION":return"Access denied. You may not have permission to view this content.";case"VALIDATION":return"Invalid request. Please check your input and try again.";default:return"An unexpected error occurred. Please try again."}}generateErrorId(){return`${this.category}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}toJSON(){return{errorId:this.errorId,name:this.name,message:this.message,userMessage:this.userMessage,category:this.category,severity:this.severity,recoverable:this.recoverable,actionable:this.actionable,retryable:this.retryable,context:this.context,stack:this.stack,originalError:this.originalError?{name:this.originalError.name,message:this.originalError.message,stack:this.originalError.stack}:void 0}}static createNetworkError(e,s,r){return new f({category:"NETWORK",severity:"HIGH",message:e,originalError:s,context:r,recoverable:!0,retryable:!0,userMessage:"Network connection failed. Please check your internet connection and try again."})}static createStreamError(e,s,r){return new f({category:"STREAM",severity:"HIGH",message:e,originalError:s,context:r,recoverable:!0,retryable:!0,userMessage:"Failed to load video stream. The content may be temporarily unavailable."})}static createPlayerError(e,s,r){return new f({category:"PLAYER",severity:"MEDIUM",message:e,originalError:s,context:r,recoverable:!0,retryable:!1,userMessage:"Video player error. Try refreshing the page or using a different browser."})}static createAddonError(e,s,r){return new f({category:"ADDON",severity:"MEDIUM",message:e,originalError:s,context:r,recoverable:!0,retryable:!0,userMessage:"Content source temporarily unavailable. Please try again later."})}static createValidationError(e,s){return new f({category:"VALIDATION",severity:"LOW",message:e,context:s,recoverable:!1,retryable:!1,userMessage:"Invalid request. Please check your input and try again."})}static createPermissionError(e,s){return new f({category:"PERMISSION",severity:"HIGH",message:e,context:s,recoverable:!1,retryable:!1,userMessage:"Access denied. You may not have permission to view this content."})}}class P{constructor(t={}){o(this,"options");o(this,"buffer",[]);o(this,"flushTimer",null);o(this,"sessionId");this.options={level:1,enableConsole:!0,enableRemote:!1,bufferSize:100,flushInterval:3e4,...t},this.sessionId=t.sessionId||this.generateSessionId(),this.options.enableRemote&&w&&this.startFlushTimer(),window.addEventListener("error",e=>{this.error("Unhandled error",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error?.stack})}),window.addEventListener("unhandledrejection",e=>{this.error("Unhandled promise rejection",{reason:e.reason,promise:e.promise})})}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}shouldLog(t){return t>=this.options.level}createLogEntry(t,e,s,r){return{level:t,message:e,timestamp:Date.now(),category:s,metadata:r,userId:this.options.userId,sessionId:this.sessionId}}addToBuffer(t){this.buffer.push(t),this.buffer.length>=this.options.bufferSize&&this.flush()}async flush(){if(this.buffer.length===0||!this.options.enableRemote||!this.options.remoteEndpoint)return;const t=[...this.buffer];this.buffer=[];try{await fetch(this.options.remoteEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({logs:t})})}catch{this.options.enableConsole}}startFlushTimer(){this.flushTimer=setInterval(()=>{this.flush()},this.options.flushInterval)}log(t,e,s,r,i){if(!this.shouldLog(t))return;const d=this.createLogEntry(e,s,r,i);if(this.options.enableConsole&&w){const c=console[e]||console.log,h=`[${new Date(d.timestamp).toISOString()}] [${e.toUpperCase()}] [${r}]`;i&&Object.keys(i).length>0?c(`${h} ${s}`,i):c(`${h} ${s}`)}this.options.enableRemote&&this.addToBuffer(d)}debug(t,e,s="APP"){this.log(0,"debug",t,s,e)}info(t,e,s="APP"){this.log(1,"info",t,s,e)}warn(t,e,s="APP"){this.log(2,"warn",t,s,e)}error(t,e,s="APP"){this.log(3,"error",t,s,e)}player(t,e,s){this[t](e,s,"PLAYER")}stream(t,e,s){this[t](e,s,"STREAM")}addon(t,e,s){this[t](e,s,"ADDON")}network(t,e,s){this[t](e,s,"NETWORK")}ui(t,e,s){this[t](e,s,"UI")}performance(t,e,s){this[t](e,s,"PERFORMANCE")}setLevel(t){this.options.level=t}setUserId(t){this.options.userId=t}getSessionId(){return this.sessionId}async forceFlush(){await this.flush()}destroy(){this.flushTimer&&(clearInterval(this.flushTimer),this.flushTimer=null),this.flush()}time(t){this.shouldLog(0)}timeEnd(t,e){this.shouldLog(0)&&this.debug(`Timer '${t}' finished`,e,"PERFORMANCE")}group(t){this.options.enableConsole,this.debug(`Started group: ${t}`,void 0,"GROUP")}groupEnd(t){this.options.enableConsole,t&&this.debug(`Ended group: ${t}`,void 0,"GROUP")}}const u=new P({level:0,enableConsole:!0,enableRemote:!1,bufferSize:50,flushInterval:3e4});window.addEventListener("beforeunload",()=>{u.destroy()});class E{constructor(t={}){o(this,"cache",new Map);o(this,"options");o(this,"cleanupTimer",null);this.options={ttl:300*1e3,maxSize:50*1024*1024,maxEntries:1e3,onEvict:()=>{},...t},this.startCleanupTimer(),u.debug("Cache initialized",{ttl:this.options.ttl,maxSize:this.options.maxSize,maxEntries:this.options.maxEntries},"CACHE")}startCleanupTimer(){this.cleanupTimer=setInterval(()=>{this.cleanup()},300*1e3)}cleanup(){const t=Date.now();let e=0;for(const[s,r]of this.cache.entries())this.isExpired(r,t)&&(this.options.onEvict(s,r.data),this.cache.delete(s),e++);e>0&&u.debug(`Cleaned up ${e} expired cache entries`,void 0,"CACHE")}isExpired(t,e=Date.now()){return e>t.timestamp+t.ttl}enforceLimit(){for(;this.cache.size>this.options.maxEntries;){const t=this.cache.keys().next().value;if(t){const e=this.cache.get(t);e&&this.options.onEvict(t,e.data),this.cache.delete(t)}}this.getTotalSize()>this.options.maxSize&&this.evictLRU()}getTotalSize(){let t=0;for(const e of this.cache.values())t+=e.size||0;return t}evictLRU(){const t=Array.from(this.cache.entries()).sort((e,s)=>e[1].timestamp-s[1].timestamp);for(const[e,s]of t)if(this.options.onEvict(e,s.data),this.cache.delete(e),this.getTotalSize()<=this.options.maxSize)break}calculateSize(t){try{return JSON.stringify(t).length*2}catch{return 1024}}set(t,e,s){const r=s||this.options.ttl,i=this.calculateSize(e),d={key:t,data:e,timestamp:Date.now(),ttl:r,size:i};if(this.cache.has(t)){const c=this.cache.get(t);c&&this.options.onEvict(t,c.data)}this.cache.set(t,d),this.enforceLimit(),u.debug(`Cached data for key: ${t}`,{size:i,ttl:r,totalEntries:this.cache.size},"CACHE")}get(t){const e=this.cache.get(t);return e?this.isExpired(e)?(this.options.onEvict(t,e.data),this.cache.delete(t),u.debug(`Cache expired for key: ${t}`,void 0,"CACHE"),null):(e.timestamp=Date.now(),u.debug(`Cache hit for key: ${t}`,void 0,"CACHE"),e.data):(u.debug(`Cache miss for key: ${t}`,void 0,"CACHE"),null)}has(t){const e=this.cache.get(t);return e?this.isExpired(e)?(this.options.onEvict(t,e.data),this.cache.delete(t),!1):!0:!1}delete(t){const e=this.cache.get(t);return e&&this.options.onEvict(t,e.data),this.cache.delete(t)}clear(){for(const[t,e]of this.cache.entries())this.options.onEvict(t,e.data);this.cache.clear(),u.info("Cache cleared",void 0,"CACHE")}getStats(){const t=Date.now();let e=0,s=0;for(const r of this.cache.values())this.isExpired(r,t)&&e++,s+=r.size||0;return{totalEntries:this.cache.size,expiredEntries:e,activeEntries:this.cache.size-e,totalSize:s,maxSize:this.options.maxSize,maxEntries:this.options.maxEntries,utilizationPercent:s/this.options.maxSize*100}}destroy(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null),this.clear(),u.debug("Cache destroyed",void 0,"CACHE")}}class M extends E{constructor(){super({ttl:300*1e3,maxEntries:500,maxSize:25*1024*1024})}cacheRequest(t,e,s,r){const i=this.createRequestKey(t,e);this.set(i,s,r)}getRequest(t,e){const s=this.createRequestKey(t,e);return this.get(s)}createRequestKey(t,e){const s=Object.keys(e).sort().reduce((r,i)=>(r[i]=e[i],r),{});return`${t}:${JSON.stringify(s)}`}}class O extends E{constructor(){super({ttl:1800*1e3,maxEntries:1e3,maxSize:50*1024*1024})}}class L extends E{constructor(){super({ttl:600*1e3,maxEntries:200,maxSize:10*1024*1024})}}const N=new M,v=new O,z=new L;function U(...n){return n.map(t=>String(t)).join(":")}async function D(n,t,e,s){const r=n.get(t);if(r!==null)return r;u.debug(`Fetching data for cache key: ${t}`,void 0,"CACHE");const i=await e();return n.set(t,i,s),i}typeof window<"u"&&window.addEventListener("beforeunload",()=>{N.destroy(),v.destroy(),z.destroy()});class k{constructor(){o(this,"addons",[]);o(this,"initialized",!1);o(this,"requestTimeout",1e4);o(this,"maxRetries",3)}async addAddon(t){try{let e=t.replace("stremio://","https://");e=decodeURIComponent(e),u.addon("info",`Fetching addon manifest from: ${e}`);const s=U("manifest",e),r=await D(v,s,()=>this.fetchWithTimeout(e),1800*1e3);u.addon("debug",`Manifest for ${e}`,{manifest:r});const i=e.replace("/manifest.json","");this.addons.push({manifest:r,baseUrl:i}),u.addon("info",`Added addon: ${r.name} (${r.id})`,{baseUrl:i,types:r.types,catalogCount:r.catalogs?.length||0}),(i.includes("%")||i.includes("|"))&&u.addon("warn",`BaseURL contains special characters: ${i}`,{baseUrl:i})}catch(e){const s=f.createAddonError(`Failed to add addon from ${t}`,e instanceof Error?e:new Error(String(e)),{metadata:{manifestUrl:t}});throw u.addon("error",s.message,{errorId:s.errorId}),s}}async fetchWithTimeout(t,e=this.requestTimeout){const s=new AbortController,r=setTimeout(()=>s.abort(),e);try{const i=await fetch(t,{signal:s.signal,headers:{"User-Agent":"HighSeas/1.0",Accept:"application/json"}});if(clearTimeout(r),!i.ok)throw f.createNetworkError(`HTTP ${i.status}: ${i.statusText}`,void 0,{metadata:{url:t,status:i.status,statusText:i.statusText}});return await i.json()}catch(i){throw clearTimeout(r),i instanceof Error&&i.name==="AbortError"?f.createNetworkError(`Request timeout after ${e}ms`,i,{metadata:{url:t,timeout:e}}):i}}async retryRequest(t,e=this.maxRetries){let s=new Error("No attempts made");for(let r=1;r<=e;r++)try{return await t()}catch(i){if(s=i instanceof Error?i:new Error(String(i)),r===e)break;const d=Math.min(1e3*Math.pow(2,r-1),1e4);u.addon("warn",`Request failed, retrying in ${d}ms (attempt ${r}/${e})`,{error:s.message}),await new Promise(c=>setTimeout(c,d))}throw s}async initialize(){if(!this.initialized){y.preInstalledAddons.forEach((t,e)=>{t.includes("%")});for(const t of y.preInstalledAddons)try{await this.addAddon(t)}catch{}for(const t of y.defaultAddons)try{await this.addAddon(t)}catch{}this.initialized=!0}}getAddons(){return this.addons}async getCatalog(t,e,s){const r=[];for(const i of this.addons)if(!(!i.manifest.resources.some(a=>typeof a=="string"?a==="catalog":a.name==="catalog")||!i.manifest.types.includes(t)||!i.manifest.catalogs?.some(a=>a.type===t&&a.id===e)))try{let a=`${i.baseUrl}/catalog/${t}/${e}.json`;if(s&&Object.keys(s).length>0){const g=new URLSearchParams(s);a+=`?${g.toString()}`}const h=await fetch(a);if(!h.ok)continue;const m=await h.json();if(m.metas&&Array.isArray(m.metas)){const g=m.metas.map(p=>({...p,id:p.id||p.imdb_id||p.moviedb_id?.toString()||"unknown"})).filter(p=>{const l=p.id;return!(!l||l==="unknown"||l.includes("%")||l.includes("|")||l.includes("/")||l.length>50)});r.push(...g)}}catch{}return r}async getMeta(t,e){for(const s of this.addons)if(s.manifest.resources.includes("meta")&&s.manifest.types.includes(t)&&!(s.manifest.idPrefixes&&s.manifest.idPrefixes.length>0&&!s.manifest.idPrefixes.some(i=>e.startsWith(i))))try{const r=`${s.baseUrl}/meta/${t}/${e}.json`,i=await fetch(r);if(!i.ok)continue;const d=await i.json();if(d.meta)return d.meta}catch{}return null}async getStreams(t,e){const s=[];this.addons.forEach(r=>{r.manifest.resources.map(i=>typeof i=="string"?i:i.name||"unknown")});for(const r of this.addons){if(r.manifest.resources.map(a=>typeof a=="string"?a:a.name||"unknown"),!r.manifest.resources.some(a=>typeof a=="string"?a==="stream":a.name==="stream")||!r.manifest.types.includes(t))continue;let d=r.manifest.idPrefixes||[];const c=r.manifest.resources.find(a=>typeof a=="object"&&a.name==="stream");if(c&&typeof c=="object"&&c.idPrefixes&&(d=[...d,...c.idPrefixes]),!(d.length>0&&!d.some(h=>e.startsWith(h))))try{const a=`${r.baseUrl}/stream/${t}/${e}.json`,h=await fetch(a);if(!h.ok)continue;const m=await h.json();if(m.streams&&Array.isArray(m.streams)){const g=S(m.streams);s.push(...g)}}catch{}}return s}async search(t,e){const s=[],r=new Set;for(const i of this.addons){if(!i.manifest.resources.some(a=>typeof a=="string"?a==="catalog":a.name==="catalog"))continue;const c=i.manifest.catalogs?.filter(a=>!e||a.type===e);if(c?.length)for(const a of c)try{const h=`${i.baseUrl}/catalog/${a.type}/${a.id}.json?search=${encodeURIComponent(t)}`,m=await fetch(h);if(!m.ok)continue;const g=await m.json();if(g.metas&&Array.isArray(g.metas)){const p=g.metas.map(l=>({...l,id:l.id||l.imdb_id||l.moviedb_id?.toString()||"unknown"})).filter(l=>r.has(l.id)||!l.id||l.id==="unknown"||l.id.includes("%")||l.id.includes("|")||l.id.length>50?!1:(r.add(l.id),!0));s.push(...p)}}catch{}}return s}}const H=new k;export{T as E,f as S,$ as a,u as l,H as s};
//# sourceMappingURL=BTEk0YJV.js.map
